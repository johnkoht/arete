# Agent Memory Management

You are an AI assistant that learns and adapts through a structured memory system. This rule defines when and how you update memory. **Memory routing depends on mode** — check `arete-context.mdc` to determine BUILDER vs GUIDE.

---

## Mode-Aware Memory Routing

### BUILDER mode (Areté source repo)

In BUILDER mode, memory about the developer goes to `.cursor/build/`:

| Content | Location |
|---------|----------|
| Architecture decisions, refactors, tooling changes | `.cursor/build/entries/YYYY-MM-DD_slug.md` |
| Collaboration observations (in entry Learnings section) | `.cursor/build/entries/YYYY-MM-DD_slug.md` |
| Synthesized builder collaboration profile | `.cursor/build/collaboration.md` |
| Index of all entries | `.cursor/build/MEMORY.md` |
| "Park this for later" | `now/scratchpad.md` |

**Do not** write to `memory/items/` or `.arete/memory/` in BUILDER mode — those are product templates for end users.

### GUIDE mode (end-user workspace)

In GUIDE mode, memory about the PM user goes to `.arete/memory/`:

| Content | Location |
|---------|----------|
| Key decisions with rationale | `.arete/memory/items/decisions.md` |
| Insights from work | `.arete/memory/items/learnings.md` |
| Observations about working with user | `.arete/memory/items/agent-observations.md` |
| Synthesized user collaboration profile | `.arete/memory/summaries/collaboration.md` |
| Work session tracking | `.arete/memory/summaries/sessions.md` |
| Chronological activity record | `.arete/activity/activity-log.md` |
| "Park this for later" | `now/scratchpad.md` |
| Timestamped permanent capture | `resources/notes/` |

---

## GUIDE Mode: Memory Architecture

```
resources/                    # L1: Raw, immutable, timestamped
├── meetings/                 # Meeting notes and transcripts
└── notes/                    # Standalone notes

.arete/
├── memory/
│   ├── items/                # L2: Atomic facts (extracted)
│   │   ├── decisions.md      # Key decisions with rationale
│   │   ├── learnings.md      # Insights from work
│   │   └── agent-observations.md # Your observations about working with user
│   └── summaries/            # L3: Synthesized context (evolving)
│       ├── collaboration.md  # How to work with user (derived from observations)
│       └── sessions.md       # Work session tracking
└── activity/
    └── activity-log.md       # Chronological activity record

now/scratchpad.md             # Shared working space (user + agent)
```

## GUIDE Mode: Observation Triggers (L2 → agent-observations.md)

Record an observation when:

1. **User edits your output**: Analyze the diff, note the pattern
   - Example: "You removed passive voice from PRD intro → preference for direct, active language"

2. **User gives explicit feedback**: "I prefer X" or "Don't do Y"
   - Capture immediately with exact wording

3. **User corrects you**: "That's not right because..."
   - Note the correction and the reason

4. **You notice a pattern**: Same behavior appears 2-3 times
   - Document the pattern you've observed

5. **User states a preference**: About process, communication, or domain
   - Log preferences explicitly

### How to Record (GUIDE mode)

- Add to the appropriate section in `.arete/memory/items/agent-observations.md`
- Format: `- [YYYY-MM-DD] [Observation] → [Implication]`
- Be specific and atomic - one fact per line
- Always tell the user when you're saving an observation

### Synthesis Triggers (L3 → collaboration.md)

Offer to update the collaboration profile when:

1. **5+ new observations** have accumulated
2. **After a major project** completes
3. **User asks** to review or update the profile

Synthesize by reviewing all observations in `agent-observations.md`, updating `.arete/memory/summaries/collaboration.md`, noting the date and count, and asking the user to review.

---

## BUILDER Mode: Observation Triggers

The same triggers apply (feedback, corrections, patterns, preferences), but observations are recorded differently:

### How to Record (BUILDER mode)

- Include a **Learnings** section in the current build entry (`.cursor/build/entries/YYYY-MM-DD_slug.md`)
- Learnings can include: collaboration observations, builder preferences, corrections, working patterns
- Format: `- [Observation] → [Implication]`
- Always tell the builder when you're noting a collaboration observation

### Synthesis Triggers (→ collaboration.md)

Offer to update `.cursor/build/collaboration.md` when:

1. **Several entries** have accumulated learnings about collaboration
2. **After a major build phase** completes
3. **Builder asks** to review or update the profile

Synthesize by reviewing Learnings sections across recent entries, updating `.cursor/build/collaboration.md`, noting the date, and asking the builder to review.

---

## Session Tracking

### GUIDE mode (→ `.arete/memory/summaries/sessions.md`)

Update session tracking:

1. **At start of substantive work**: Note what we're working on
2. **At natural breaks**: Update context and open questions
3. **At session end**: Log what we did, where we stopped

```markdown
## Active Session
**Started**: [date]
**Project**: [if applicable]
**Working On**: [current focus]
**Context**: [key info needed to resume]
**Open Questions**: [unresolved items]
**Next Steps**: [what we planned to do next]
```

### BUILDER mode

Session context is captured in build entries. No separate session file needed — entries are already timestamped and include context.

---

## Scratchpad Usage

The scratchpad (`now/scratchpad.md`) is a **shared working space** for both user/builder and agent. Same in both modes.

### When to Add to Scratchpad

- User says "let's punt on that" or "park it for later"
- User explicitly asks to add something
- You have an idea worth capturing but not acting on now
- Questions come up that aren't immediately relevant

---

## Transparency Rules

1. **Always tell the user** when saving an observation
   - "I'm noting that you prefer X — I'll add this to my observations."

2. **Ask before synthesizing** the collaboration profile
   - "I have several new observations. Would you like me to update the collaboration profile?"

3. **Ask if work should be added to memory**
   - After substantive work (refactors, decisions, bug fixes, migrations), **ask**: "Should I add this to memory?" — and specify which: **build memory** (`.cursor/build/MEMORY.md` + entries) or **PM workspace memory** (`.arete/memory/items/`). Don't add without confirming unless the user has already asked you to record it.

4. **Corrections become new observations**
   - If user corrects your synthesis, log it as a new observation (in the appropriate location for the current mode), don't silently edit

5. **User can review and edit** any memory file directly.

---

## Example Interaction (GUIDE mode)

```
User: [edits your PRD, removing jargon and adding user quotes]

Agent: I noticed you made some edits to the PRD:
- Removed technical jargon in favor of plain language
- Added user quotes to support each requirement

I'm adding these to my observations:
- [2026-02-03] Removed jargon → preference for plain language over technical terms
- [2026-02-03] Added user quotes → evidence-based framing preferred

I'll apply this to future PRDs.
```

## Example Interaction (BUILDER mode)

```
Builder: [asks for 3 options before choosing an approach]

Agent: I noticed you prefer seeing multiple options before deciding.
I'll add this to the Learnings section of the current entry:
- Builder prefers 2-3 options before committing → present choices, not prescriptions

I'll update collaboration.md when a few more observations accumulate.
```

---

## Memory Maintenance

- **GUIDE**: Review `agent-observations.md` periodically for patterns; synthesize into `collaboration.md`
- **BUILDER**: Review Learnings across entries; synthesize into `.cursor/build/collaboration.md`
- Keep observations atomic — split compound observations
- Archive old session history if it grows too long
