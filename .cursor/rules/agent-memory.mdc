# Agent Memory Management

You are an AI assistant that learns and adapts through a structured memory system. This rule defines when and how you update memory.

## Memory Architecture

```
resources/                    # L1: Raw, immutable, timestamped
├── meetings/                 # Meeting notes and transcripts
└── notes/                    # Standalone notes

memory/
├── items/                    # L2: Atomic facts (extracted)
│   ├── decisions.md          # Key decisions with rationale
│   ├── learnings.md          # Insights from work
│   └── agent-observations.md # Your observations about working with user
├── summaries/                # L3: Synthesized context (evolving)
│   ├── collaboration.md      # How to work with user (derived from observations)
│   └── sessions.md           # Work session tracking
└── activity-log.md           # Chronological activity record

scratchpad.md                 # Shared working space (user + agent)
```

## Observation Triggers (L2 → agent-observations.md)

Record an observation when:

1. **User edits your output**: Analyze the diff, note the pattern
   - Example: "You removed passive voice from PRD intro → preference for direct, active language"

2. **User gives explicit feedback**: "I prefer X" or "Don't do Y"
   - Capture immediately with exact wording

3. **User corrects you**: "That's not right because..."
   - Note the correction and the reason

4. **You notice a pattern**: Same behavior appears 2-3 times
   - Document the pattern you've observed

5. **User states a preference**: About process, communication, or domain
   - Log preferences explicitly

### How to Record Observations

- Add to the appropriate section in `memory/items/agent-observations.md`
- Format: `- [YYYY-MM-DD] [Observation] → [Implication]`
- Be specific and atomic - one fact per line
- Always tell the user when you're saving an observation

## Synthesis Triggers (L3 → collaboration.md)

Offer to update the collaboration profile when:

1. **5+ new observations** have accumulated
2. **After a major project** completes
3. **User asks** to review or update the profile

### How to Synthesize

- Review all observations in `agent-observations.md`
- Update relevant sections in `memory/summaries/collaboration.md`
- Note the synthesis date and observation count
- Ask user to review and correct if needed

## Session Tracking (L3 → sessions.md)

Update session tracking:

1. **At start of substantive work**: Note what we're working on
2. **At natural breaks**: Update context and open questions
3. **At session end**: Log what we did, where we stopped

### Session Format

```markdown
## Active Session
**Started**: [date]
**Project**: [if applicable]
**Working On**: [current focus]
**Context**: [key info needed to resume]
**Open Questions**: [unresolved items]
**Next Steps**: [what we planned to do next]
```

## Scratchpad Usage

The scratchpad is a **shared working space** for both user and agent.

### When to Add to Scratchpad

- User says "let's punt on that" or "park it for later"
- User explicitly asks to add something
- You have an idea worth capturing but not acting on now
- Questions come up that aren't immediately relevant

### What Goes Where

| Content | Location |
|---------|----------|
| "Park this for later" | scratchpad.md |
| Timestamped permanent capture | resources/notes/ |
| Key decision made | memory/items/decisions.md |
| Insight learned | memory/items/learnings.md |
| Observation about user | memory/items/agent-observations.md |

## Transparency Rules

1. **Always tell the user** when saving an observation
   - "I'm noting that you prefer X - I'll add this to my observations."

2. **Ask before synthesizing** the collaboration profile
   - "I have several new observations. Would you like me to update the collaboration profile?"

3. **Corrections become new observations**
   - If user corrects your synthesis, log it as a new observation, don't silently edit

4. **User can review and edit** any memory file directly

## Example Interaction

```
User: [edits your PRD, removing jargon and adding user quotes]

Agent: I noticed you made some edits to the PRD:
- Removed technical jargon in favor of plain language
- Added user quotes to support each requirement

I'm adding these to my observations:
- [2026-02-03] Removed jargon → preference for plain language over technical terms
- [2026-02-03] Added user quotes → evidence-based framing preferred

I'll apply this to future PRDs.
```

## Memory Maintenance

- Review `agent-observations.md` periodically for patterns
- Keep observations atomic - split compound observations
- Archive old session history if it grows too long
- Update `collaboration.md` when synthesis is due
