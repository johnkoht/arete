---
description: Dev practices for Arete — lint, format, conventions, build memory
globs: ["src/**/*", "test/**/*", "scripts/**/*", "bin/**/*", ".cursor/**/*"]
alwaysApply: true
---

# Dev practices (Arete build)

**Only when in Build Context (BUILDER mode).** See `arete-context.mdc`. If `agent_mode` is `guide` or you are in an end-user workspace, ignore this rule.

Standards for building and changing Arete. **Testing** is covered in `testing.mdc`; this rule covers the rest.

## Build memory

- **USER.md** (root, gitignored): User-specific context. Copy from `USER.md.example` and fill in local env, preferences, reminders.
- **MEMORY.md**: `.cursor/build/MEMORY.md` — index of significant build/architecture changes.
- **Entries**: `.cursor/build/entries/YYYY-MM-DD_short-title.md` — one file per change; add when refactoring, changing tooling, or making decisions worth remembering. Include a **Learnings** section for collaboration observations, builder preferences, and working patterns.
- **Collaboration**: `.cursor/build/collaboration.md` — synthesized profile of how to work with the builder, derived from Learnings in entries. Reviewed and updated periodically. See `agent-memory.mdc` for when to synthesize.
- **PRDs for Areté features**: Put PRDs in `.cursor/build/prds/{feature-name}/prd.md`, not in `projects/active/`. `projects/active/` is for PMs *using* Areté; `.cursor/build/` is internal build tooling.

**Prompt to add**: After a notable refactor, tooling change, architectural decision, or fix worth remembering (e.g. URL bugs, migration from one stack to another), **ask the user**: “Should I add this to build memory (.cursor/build/MEMORY.md)?” If yes, create a dated entry and add a line to the index. If you noticed collaboration patterns during the session, include them in the entry's Learnings section.

## Pre-mortem for complex work

For **multi-step work** (PRD execution, large refactors, new systems, integration work)—and **when using Plan Mode**—conduct a pre-mortem before execution.

- **When**: After the plan is drafted, before executing it. Use for PRDs, refactors touching many files, new systems, integration work. Skip for single, well-understood tasks.
- **How**: Use `.cursor/build/templates/PRE-MORTEM-TEMPLATE.md` (risk categories, format). For each risk: Problem → Mitigation → Verification. Present to user; get approval; apply mitigations during execution.
- **Plan Mode**: The rule `plan-pre-mortem.mdc` requires a pre-mortem when the agent is in Plan Mode or has created a multi-step plan. Follow it so Plan Mode runs get the same risk mitigation as execute-prd.
- **References**: `.cursor/build/PRE-MORTEM-AND-ORCHESTRATION-RECOMMENDATIONS.md`, `.cursor/build/skills/execute-prd/SKILL.md`.

## TypeScript / Node.js

- **Config**: `tsconfig.json` (NodeNext, strict). Tests: `tsconfig.test.json`.
- **Imports**: Use `.js` extensions for local modules (NodeNext resolution). Use `import type` when a symbol is only used as a type.
- **Style**: Prefer `const`/`let`; avoid `var`. Use strict equality. No unused vars. Use optional chaining and nullish coalescing (`??`) where they clarify intent.
- **Types**: Prefer `type` over `interface` except for public API contracts. Avoid `any` and `unknown`; avoid `as` or `!` unless necessary (e.g. known-safe casts after validation).
- **Functions**: Use the `function` keyword for top-level/named functions; arrow functions for callbacks and short inline use. Descriptive names (verbs + nouns, e.g. `getUserData`). Use default parameters and destructuring where it improves readability.
- **Naming**: PascalCase for types/classes; camelCase for variables, functions, methods; UPPERCASE for constants and env-related names. Files/dirs: kebab-case.
- **Structure**: Prefer functional, declarative code; avoid classes unless stateful encapsulation is needed. Use constants for magic numbers and repeated values. Iterate and modularize rather than duplicating.
- **Async**: Prefer `async`/`await` over raw Promises.
- **Security**: Use environment variables (or `.credentials`/config) for secrets; validate and sanitize CLI inputs and file paths; avoid executing user-controlled strings as shell commands.
- **Tests**: `node:test` + `node:assert/strict`; see `testing.mdc`.

## Python

- **Location**: `scripts/integrations/`. Tests: `test_*.py` in same directory.
- **Style**: unittest; mock external I/O. See `testing.mdc` for runner and patterns.

## Linting / formatting

- No ESLint or Prettier in the repo yet. For now:
  - Match existing style in the file (indent, quotes, semicolons).
  - Run `npm run typecheck` and `npm test` / `npm run test:all` before committing.
- If you add ESLint or Prettier, document config and scripts here and in MEMORY.

## Before committing

1. `npm run typecheck`
2. `npm run test:all` (or `npm test` + `npm run test:py`)
3. New code → new/updated tests (see `testing.mdc`)

## References

- **Testing**: `.cursor/rules/testing.mdc`
- **Build memory**: `.cursor/build/MEMORY.md`, `USER.md.example`
- **Node/TS conventions**: Informed by [Cursor Directory Node.js rules](https://cursor.directory/rules/node.js); Payload/Vue/Mongo-specific parts omitted.
