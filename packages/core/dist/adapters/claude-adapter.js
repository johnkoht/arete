/**
 * Claude Code IDE Adapter
 *
 * Adapters may use fs directly (infrastructure).
 */
import { existsSync } from 'fs';
import { join } from 'path';
import { readPrebuiltAgentsMd, generateMinimalAgentsMd } from './read-agents-md.js';
/**
 * Transform Cursor-specific paths to Claude-specific paths.
 * dist/AGENTS.md uses .cursor/ paths; Claude needs .claude/.
 */
function transformPathsForClaude(content) {
    return content
        .replace(/\.cursor\/skills\//g, '.agents/skills/')
        .replace(/\.cursor\//g, '.claude/')
        .replace(/\.mdc\b/g, '.md');
}
export class ClaudeAdapter {
    target = 'claude';
    configDirName = '.claude';
    ruleExtension = '.md';
    getIDEDirs() {
        return [
            '.claude',
            '.claude/rules',
            '.claude/tools',
            '.claude/integrations',
            '.claude/integrations/configs',
        ];
    }
    rulesDir() {
        return '.claude/rules';
    }
    toolsDir() {
        return '.claude/tools';
    }
    integrationsDir() {
        return '.claude/integrations';
    }
    formatRule(rule, _config) {
        const frontmatter = {
            description: rule.description,
        };
        if (rule.alwaysApply !== true && rule.globs && rule.globs.length > 0) {
            frontmatter.globs = rule.globs;
        }
        const yamlLines = ['---'];
        for (const [key, value] of Object.entries(frontmatter)) {
            if (Array.isArray(value)) {
                yamlLines.push(`${key}:`);
                for (const item of value) {
                    yamlLines.push(`  - "${item}"`);
                }
            }
            else if (typeof value === 'boolean') {
                yamlLines.push(`${key}: ${value}`);
            }
            else {
                yamlLines.push(`${key}: ${value}`);
            }
        }
        yamlLines.push('---');
        return `${yamlLines.join('\n')}\n\n${rule.content}`;
    }
    transformRuleContent(content) {
        return content
            .replace(/\.cursor\/skills\//g, '.agents/skills/')
            .replace(/\.cursor\//g, '.claude/')
            .replace(/\.mdc\b/g, '.md');
    }
    generateRootFiles(config, _workspaceRoot, _sourceRulesDir) {
        const timestamp = new Date().toISOString();
        const version = config.version || '1.0.0';
        // Try to read pre-built comprehensive AGENTS.md from dist/
        let claudeMd = readPrebuiltAgentsMd();
        if (claudeMd) {
            // Transform .cursor/ paths to .claude/ paths
            claudeMd = transformPathsForClaude(claudeMd);
        }
        else {
            // Fall back to minimal version if pre-built not available
            claudeMd = generateMinimalAgentsMd();
        }
        // Append version footer
        const versionFooter = `
---

## Version

Generated by Aret√© v${version} on ${timestamp}
`;
        claudeMd = claudeMd.trimEnd() + '\n' + versionFooter;
        return { 'CLAUDE.md': claudeMd };
    }
    detectInWorkspace(workspaceRoot) {
        return existsSync(join(workspaceRoot, '.claude'));
    }
}
//# sourceMappingURL=claude-adapter.js.map